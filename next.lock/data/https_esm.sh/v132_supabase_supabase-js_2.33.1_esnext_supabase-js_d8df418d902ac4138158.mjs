/* esm.sh - esbuild bundle(@supabase/supabase-js@2.33.1) esnext production */
import{FunctionsClient as F}from"/v132/@supabase/functions-js@2.1.4/esnext/functions-js.mjs";import{PostgrestClient as D}from"/v132/@supabase/postgrest-js@1.8.4/esnext/postgrest-js.mjs";import{RealtimeClient as j}from"/v132/@supabase/realtime-js@2.7.4/esnext/realtime-js.mjs";import{StorageClient as L}from"/v132/@supabase/storage-js@2.5.3/esnext/storage-js.mjs";var g="2.33.1";var x={"X-Client-Info":`supabase-js/${g}`};import E,{Headers as S}from"/v132/cross-fetch@3.1.8/esnext/cross-fetch.mjs";var A=function(o,t,e,s){function l(n){return n instanceof e?n:new e(function(i){i(n)})}return new(e||(e=Promise))(function(n,i){function h(a){try{r(s.next(a))}catch(u){i(u)}}function c(a){try{r(s.throw(a))}catch(u){i(u)}}function r(a){a.done?n(a.value):l(a.value).then(h,c)}r((s=s.apply(o,t||[])).next())})},y=o=>{let t;return o?t=o:typeof fetch>"u"?t=E:t=fetch,(...e)=>t(...e)},w=()=>typeof Headers>"u"?S:Headers,_=(o,t,e)=>{let s=y(e),l=w();return(n,i)=>A(void 0,void 0,void 0,function*(){var h;let c=(h=yield t())!==null&&h!==void 0?h:o,r=new l(i?.headers);return r.has("apikey")||r.set("apikey",o),r.has("Authorization")||r.set("Authorization",`Bearer ${c}`),s(n,Object.assign(Object.assign({},i),{headers:r}))})};function v(o){return o.replace(/\/$/,"")}function b(o,t){let{db:e,auth:s,realtime:l,global:n}=o,{db:i,auth:h,realtime:c,global:r}=t;return{db:Object.assign(Object.assign({},i),e),auth:Object.assign(Object.assign({},h),s),realtime:Object.assign(Object.assign({},c),l),global:Object.assign(Object.assign({},r),n)}}import{GoTrueClient as C}from"/v132/@supabase/gotrue-js@2.48.1/esnext/gotrue-js.mjs";var m=class extends C{constructor(t){super(t)}};var U=function(o,t,e,s){function l(n){return n instanceof e?n:new e(function(i){i(n)})}return new(e||(e=Promise))(function(n,i){function h(a){try{r(s.next(a))}catch(u){i(u)}}function c(a){try{r(s.throw(a))}catch(u){i(u)}}function r(a){a.done?n(a.value):l(a.value).then(h,c)}r((s=s.apply(o,t||[])).next())})},I={headers:x},H={schema:"public"},N={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},R={},f=class{constructor(t,e,s){var l,n,i,h,c,r,a,u;if(this.supabaseUrl=t,this.supabaseKey=e,!t)throw new Error("supabaseUrl is required.");if(!e)throw new Error("supabaseKey is required.");let p=v(t);this.realtimeUrl=`${p}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${p}/auth/v1`,this.storageUrl=`${p}/storage/v1`,this.functionsUrl=`${p}/functions/v1`;let O=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,T={db:H,realtime:R,auth:Object.assign(Object.assign({},N),{storageKey:O}),global:I},d=b(s??{},T);this.storageKey=(n=(l=d.auth)===null||l===void 0?void 0:l.storageKey)!==null&&n!==void 0?n:"",this.headers=(h=(i=d.global)===null||i===void 0?void 0:i.headers)!==null&&h!==void 0?h:{},this.auth=this._initSupabaseAuthClient((c=d.auth)!==null&&c!==void 0?c:{},this.headers,(r=d.global)===null||r===void 0?void 0:r.fetch),this.fetch=_(e,this._getAccessToken.bind(this),(a=d.global)===null||a===void 0?void 0:a.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},d.realtime)),this.rest=new D(`${p}/rest/v1`,{headers:this.headers,schema:(u=d.db)===null||u===void 0?void 0:u.schema,fetch:this.fetch}),this._listenForAuthEvents()}get functions(){return new F(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new L(this.storageUrl,this.headers,this.fetch)}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,e={},s){return this.rest.rpc(t,e,s)}channel(t,e={config:{}}){return this.realtime.channel(t,e)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var t,e;return U(this,void 0,void 0,function*(){let{data:s}=yield this.auth.getSession();return(e=(t=s.session)===null||t===void 0?void 0:t.access_token)!==null&&e!==void 0?e:null})}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:e,detectSessionInUrl:s,storage:l,storageKey:n,flowType:i,debug:h},c,r){let a={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new m({url:this.authUrl,headers:Object.assign(Object.assign({},a),c),storageKey:n,autoRefreshToken:t,persistSession:e,detectSessionInUrl:s,storage:l,flowType:i,debug:h,fetch:r})}_initRealtimeClient(t){return new j(this.realtimeUrl,Object.assign(Object.assign({},t),{params:Object.assign({apikey:this.supabaseKey},t?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,s)=>{this._handleTokenChanged(e,"CLIENT",s?.access_token)})}_handleTokenChanged(t,e,s){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==s?(this.realtime.setAuth(s??null),this.changedAccessToken=s):t==="SIGNED_OUT"&&(this.realtime.setAuth(this.supabaseKey),e=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};export*from"/v132/@supabase/gotrue-js@2.48.1/esnext/gotrue-js.mjs";import{FunctionsHttpError as at,FunctionsFetchError as ot,FunctionsRelayError as ht,FunctionsError as lt}from"/v132/@supabase/functions-js@2.1.4/esnext/functions-js.mjs";export*from"/v132/@supabase/realtime-js@2.7.4/esnext/realtime-js.mjs";var st=(o,t,e)=>new f(o,t,e);export{lt as FunctionsError,ot as FunctionsFetchError,at as FunctionsHttpError,ht as FunctionsRelayError,f as SupabaseClient,st as createClient};
//# sourceMappingURL=supabase-js.mjs.map