/* esm.sh - esbuild bundle(@supabase/storage-js@2.5.3) esnext production */
var v=class extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}};function l(i){return typeof i=="object"&&i!==null&&"__isStorageError"in i}var $=class extends v{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}},w=class extends v{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}};var E=function(i,e,t,r){function o(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function u(s){try{d(r.next(s))}catch(h){a(h)}}function c(s){try{d(r.throw(s))}catch(h){a(h)}}function d(s){s.done?n(s.value):o(s.value).then(u,c)}d((r=r.apply(i,e||[])).next())})},x=i=>{let e;return i?e=i:typeof fetch>"u"?e=(...t)=>E(void 0,void 0,void 0,function*(){return yield(yield import("/v132/cross-fetch@3.1.8/esnext/cross-fetch.mjs")).fetch(...t)}):e=fetch,(...t)=>e(...t)},T=()=>E(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield import("/v132/cross-fetch@3.1.8/esnext/cross-fetch.mjs")).Response:Response});var m=function(i,e,t,r){function o(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function u(s){try{d(r.next(s))}catch(h){a(h)}}function c(s){try{d(r.throw(s))}catch(h){a(h)}}function d(s){s.done?n(s.value):o(s.value).then(u,c)}d((r=r.apply(i,e||[])).next())})},O=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),I=(i,e)=>m(void 0,void 0,void 0,function*(){let t=yield T();i instanceof t?i.json().then(r=>{e(new $(O(r),i.status||500))}).catch(r=>{e(new w(O(r),r))}):e(new w(O(i),i))}),C=(i,e,t,r)=>{let o={method:i,headers:e?.headers||{}};return i==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json"},e?.headers),o.body=JSON.stringify(r),Object.assign(Object.assign({},o),t))};function j(i,e,t,r,o,n){return m(this,void 0,void 0,function*(){return new Promise((a,u)=>{i(t,C(e,r,o,n)).then(c=>{if(!c.ok)throw c;return r?.noResolveJson?c:c.json()}).then(c=>a(c)).catch(c=>I(c,u))})})}function g(i,e,t,r){return m(this,void 0,void 0,function*(){return j(i,"GET",e,t,r)})}function p(i,e,t,r,o){return m(this,void 0,void 0,function*(){return j(i,"POST",e,r,o,t)})}function k(i,e,t,r,o){return m(this,void 0,void 0,function*(){return j(i,"PUT",e,r,o,t)})}function S(i,e,t,r,o){return m(this,void 0,void 0,function*(){return j(i,"DELETE",e,r,o,t)})}var f=function(i,e,t,r){function o(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function u(s){try{d(r.next(s))}catch(h){a(h)}}function c(s){try{d(r.throw(s))}catch(h){a(h)}}function d(s){s.done?n(s.value):o(s.value).then(u,c)}d((r=r.apply(i,e||[])).next())})},D={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},F={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1},b=class{constructor(e,t={},r,o){this.url=e,this.headers=t,this.bucketId=r,this.fetch=x(o)}uploadOrUpdate(e,t,r,o){return f(this,void 0,void 0,function*(){try{let n,a=Object.assign(Object.assign({},F),o),u=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(a.upsert)});typeof Blob<"u"&&r instanceof Blob?(n=new FormData,n.append("cacheControl",a.cacheControl),n.append("",r)):typeof FormData<"u"&&r instanceof FormData?(n=r,n.append("cacheControl",a.cacheControl)):(n=r,u["cache-control"]=`max-age=${a.cacheControl}`,u["content-type"]=a.contentType);let c=this._removeEmptyFolders(t),d=this._getFinalPath(c),s=yield this.fetch(`${this.url}/object/${d}`,Object.assign({method:e,body:n,headers:u},a?.duplex?{duplex:a.duplex}:{}));return s.ok?{data:{path:c},error:null}:{data:null,error:yield s.json()}}catch(n){if(l(n))return{data:null,error:n};throw n}})}upload(e,t,r){return f(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,o){return f(this,void 0,void 0,function*(){let n=this._removeEmptyFolders(e),a=this._getFinalPath(n),u=new URL(this.url+`/object/upload/sign/${a}`);u.searchParams.set("token",t);try{let c,d=Object.assign({upsert:F.upsert},o),s=Object.assign(Object.assign({},this.headers),{"x-upsert":String(d.upsert)});typeof Blob<"u"&&r instanceof Blob?(c=new FormData,c.append("cacheControl",d.cacheControl),c.append("",r)):typeof FormData<"u"&&r instanceof FormData?(c=r,c.append("cacheControl",d.cacheControl)):(c=r,s["cache-control"]=`max-age=${d.cacheControl}`,s["content-type"]=d.contentType);let h=yield this.fetch(u.toString(),{method:"PUT",body:c,headers:s});return h.ok?{data:{path:n},error:null}:{data:null,error:yield h.json()}}catch(c){if(l(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e){return f(this,void 0,void 0,function*(){try{let t=this._getFinalPath(e),r=yield p(this.fetch,`${this.url}/object/upload/sign/${t}`,{},{headers:this.headers}),o=new URL(this.url+r.url),n=o.searchParams.get("token");if(!n)throw new v("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:n},error:null}}catch(t){if(l(t))return{data:null,error:t};throw t}})}update(e,t,r){return f(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t){return f(this,void 0,void 0,function*(){try{return{data:yield p(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers}),error:null}}catch(r){if(l(r))return{data:null,error:r};throw r}})}copy(e,t){return f(this,void 0,void 0,function*(){try{return{data:{path:(yield p(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers})).Key},error:null}}catch(r){if(l(r))return{data:null,error:r};throw r}})}createSignedUrl(e,t,r){return f(this,void 0,void 0,function*(){try{let o=this._getFinalPath(e),n=yield p(this.fetch,`${this.url}/object/sign/${o}`,Object.assign({expiresIn:t},r?.transform?{transform:r.transform}:{}),{headers:this.headers}),a=r?.download?`&download=${r.download===!0?"":r.download}`:"";return n={signedUrl:encodeURI(`${this.url}${n.signedURL}${a}`)},{data:n,error:null}}catch(o){if(l(o))return{data:null,error:o};throw o}})}createSignedUrls(e,t,r){return f(this,void 0,void 0,function*(){try{let o=yield p(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),n=r?.download?`&download=${r.download===!0?"":r.download}`:"";return{data:o.map(a=>Object.assign(Object.assign({},a),{signedUrl:a.signedURL?encodeURI(`${this.url}${a.signedURL}${n}`):null})),error:null}}catch(o){if(l(o))return{data:null,error:o};throw o}})}download(e,t){return f(this,void 0,void 0,function*(){let o=typeof t?.transform<"u"?"render/image/authenticated":"object",n=this.transformOptsToQueryString(t?.transform||{}),a=n?`?${n}`:"";try{let u=this._getFinalPath(e);return{data:yield(yield g(this.fetch,`${this.url}/${o}/${u}${a}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(u){if(l(u))return{data:null,error:u};throw u}})}getPublicUrl(e,t){let r=this._getFinalPath(e),o=[],n=t?.download?`download=${t.download===!0?"":t.download}`:"";n!==""&&o.push(n);let u=typeof t?.transform<"u"?"render/image":"object",c=this.transformOptsToQueryString(t?.transform||{});c!==""&&o.push(c);let d=o.join("&");return d!==""&&(d=`?${d}`),{data:{publicUrl:encodeURI(`${this.url}/${u}/public/${r}${d}`)}}}remove(e){return f(this,void 0,void 0,function*(){try{return{data:yield S(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(l(t))return{data:null,error:t};throw t}})}list(e,t,r){return f(this,void 0,void 0,function*(){try{let o=Object.assign(Object.assign(Object.assign({},D),t),{prefix:e||""});return{data:yield p(this.fetch,`${this.url}/object/list/${this.bucketId}`,o,{headers:this.headers},r),error:null}}catch(o){if(l(o))return{data:null,error:o};throw o}})}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){let t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}};var R="2.5.3";var P={"X-Client-Info":`storage-js/${R}`};var y=function(i,e,t,r){function o(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function u(s){try{d(r.next(s))}catch(h){a(h)}}function c(s){try{d(r.throw(s))}catch(h){a(h)}}function d(s){s.done?n(s.value):o(s.value).then(u,c)}d((r=r.apply(i,e||[])).next())})},_=class{constructor(e,t={},r){this.url=e,this.headers=Object.assign(Object.assign({},P),t),this.fetch=x(r)}listBuckets(){return y(this,void 0,void 0,function*(){try{return{data:yield g(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(l(e))return{data:null,error:e};throw e}})}getBucket(e){return y(this,void 0,void 0,function*(){try{return{data:yield g(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(l(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return y(this,void 0,void 0,function*(){try{return{data:yield p(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(l(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return y(this,void 0,void 0,function*(){try{return{data:yield k(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(l(r))return{data:null,error:r};throw r}})}emptyBucket(e){return y(this,void 0,void 0,function*(){try{return{data:yield p(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(l(t))return{data:null,error:t};throw t}})}deleteBucket(e){return y(this,void 0,void 0,function*(){try{return{data:yield S(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(l(t))return{data:null,error:t};throw t}})}};var U=class extends _{constructor(e,t={},r){super(e,t,r)}from(e){return new b(this.url,this.headers,e,this.fetch)}};export{$ as StorageApiError,U as StorageClient,v as StorageError,w as StorageUnknownError,l as isStorageError};
//# sourceMappingURL=storage-js.mjs.map