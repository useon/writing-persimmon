/* esm.sh - esbuild bundle(@supabase/realtime-js@2.7.4) esnext production */
import{w3cwebsocket as te}from"/v132/websocket@1.0.34/esnext/websocket.mjs";var H="2.7.4";var z={"X-Client-Info":`realtime-js/${H}`},F="1.0.0",P=1e4,q=1e3,x;(function(i){i[i.connecting=0]="connecting",i[i.open=1]="open",i[i.closing=2]="closing",i[i.closed=3]="closed"})(x||(x={}));var g;(function(i){i.closed="closed",i.errored="errored",i.joined="joined",i.joining="joining",i.leaving="leaving"})(g||(g={}));var j;(function(i){i.close="phx_close",i.error="phx_error",i.join="phx_join",i.reply="phx_reply",i.leave="phx_leave",i.access_token="access_token"})(j||(j={}));var S;(function(i){i.websocket="websocket"})(S||(S={}));var R;(function(i){i.Connecting="connecting",i.Open="open",i.Closing="closing",i.Closed="closed"})(R||(R={}));var L=class{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}};var k=class{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){let t=new DataView(e),n=new TextDecoder;return this._decodeBroadcast(e,t,n)}_decodeBroadcast(e,t,n){let s=t.getUint8(1),r=t.getUint8(2),o=this.HEADER_LENGTH+2,c=n.decode(e.slice(o,o+s));o=o+s;let l=n.decode(e.slice(o,o+r));o=o+r;let h=JSON.parse(n.decode(e.slice(o,e.byteLength)));return{ref:null,topic:c,event:l,payload:h}}};var T=class{constructor(e,t,n={},s=P){this.channel=e,this.event=t,this.payload=n,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null,this.rateLimited=!1}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){if(this._hasReceived("timeout"))return;this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()})==="rate limited"&&(this.rateLimited=!0)}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var n;return this._hasReceived(e)&&t((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);let e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(n=>n.status===e).forEach(n=>n.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}};var U;(function(i){i.SYNC="sync",i.JOIN="join",i.LEAVE="leave"})(U||(U={}));var y=class i{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};let n=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},s=>{let{onJoin:r,onLeave:o,onSync:c}=this.caller;this.joinRef=this.channel._joinRef(),this.state=i.syncState(this.state,s,r,o),this.pendingDiffs.forEach(l=>{this.state=i.syncDiff(this.state,l,r,o)}),this.pendingDiffs=[],c()}),this.channel._on(n.diff,{},s=>{let{onJoin:r,onLeave:o,onSync:c}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=i.syncDiff(this.state,s,r,o),c())}),this.onJoin((s,r,o)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:r,newPresences:o})}),this.onLeave((s,r,o)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:r,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,n,s){let r=this.cloneDeep(e),o=this.transformState(t),c={},l={};return this.map(r,(h,a)=>{o[h]||(l[h]=a)}),this.map(o,(h,a)=>{let d=r[h];if(d){let _=a.map(m=>m.presence_ref),f=d.map(m=>m.presence_ref),v=a.filter(m=>f.indexOf(m.presence_ref)<0),p=d.filter(m=>_.indexOf(m.presence_ref)<0);v.length>0&&(c[h]=v),p.length>0&&(l[h]=p)}else c[h]=a}),this.syncDiff(r,{joins:c,leaves:l},n,s)}static syncDiff(e,t,n,s){let{joins:r,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return n||(n=()=>{}),s||(s=()=>{}),this.map(r,(c,l)=>{var h;let a=(h=e[c])!==null&&h!==void 0?h:[];if(e[c]=this.cloneDeep(l),a.length>0){let d=e[c].map(f=>f.presence_ref),_=a.filter(f=>d.indexOf(f.presence_ref)<0);e[c].unshift(..._)}n(c,a,l)}),this.map(o,(c,l)=>{let h=e[c];if(!h)return;let a=l.map(d=>d.presence_ref);h=h.filter(d=>a.indexOf(d.presence_ref)<0),e[c]=h,s(c,h,l),h.length===0&&delete e[c]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(n=>t(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,n)=>{let s=e[n];return"metas"in s?t[n]=s.metas.map(r=>(r.presence_ref=r.phx_ref,delete r.phx_ref,delete r.phx_ref_prev,r)):t[n]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}};var u;(function(i){i.abstime="abstime",i.bool="bool",i.date="date",i.daterange="daterange",i.float4="float4",i.float8="float8",i.int2="int2",i.int4="int4",i.int4range="int4range",i.int8="int8",i.int8range="int8range",i.json="json",i.jsonb="jsonb",i.money="money",i.numeric="numeric",i.oid="oid",i.reltime="reltime",i.text="text",i.time="time",i.timestamp="timestamp",i.timestamptz="timestamptz",i.timetz="timetz",i.tsrange="tsrange",i.tstzrange="tstzrange"})(u||(u={}));var N=(i,e,t={})=>{var n;let s=(n=t.skipTypes)!==null&&n!==void 0?n:[];return Object.keys(e).reduce((r,o)=>(r[o]=W(o,i,e,s),r),{})},W=(i,e,t,n)=>{let s=e.find(c=>c.name===i),r=s?.type,o=t[i];return r&&!n.includes(r)?G(r,o):M(o)},G=(i,e)=>{if(i.charAt(0)==="_"){let t=i.slice(1,i.length);return Z(e,t)}switch(i){case u.bool:return X(e);case u.float4:case u.float8:case u.int2:case u.int4:case u.int8:case u.numeric:case u.oid:return Y(e);case u.json:case u.jsonb:return Q(e);case u.timestamp:return K(e);case u.abstime:case u.date:case u.daterange:case u.int4range:case u.int8range:case u.money:case u.reltime:case u.text:case u.time:case u.timestamptz:case u.timetz:case u.tsrange:case u.tstzrange:return M(e);default:return M(e)}},M=i=>i,X=i=>{switch(i){case"t":return!0;case"f":return!1;default:return i}},Y=i=>{if(typeof i=="string"){let e=parseFloat(i);if(!Number.isNaN(e))return e}return i},Q=i=>{if(typeof i=="string")try{return JSON.parse(i)}catch(e){return console.log(`JSON parse error: ${e}`),i}return i},Z=(i,e)=>{if(typeof i!="string")return i;let t=i.length-1,n=i[t];if(i[0]==="{"&&n==="}"){let r,o=i.slice(1,t);try{r=JSON.parse("["+o+"]")}catch{r=o?o.split(","):[]}return r.map(c=>G(e,c))}return i},K=i=>typeof i=="string"?i.replace(" ","T"):i;var V=function(i,e,t,n){function s(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function c(a){try{h(n.next(a))}catch(d){o(d)}}function l(a){try{h(n.throw(a))}catch(d){o(d)}}function h(a){a.done?r(a.value):s(a.value).then(c,l)}h((n=n.apply(i,e||[])).next())})},J;(function(i){i.ALL="*",i.INSERT="INSERT",i.UPDATE="UPDATE",i.DELETE="DELETE"})(J||(J={}));var $;(function(i){i.BROADCAST="broadcast",i.PRESENCE="presence",i.POSTGRES_CHANGES="postgres_changes"})($||($={}));var A;(function(i){i.SUBSCRIBED="SUBSCRIBED",i.TIMED_OUT="TIMED_OUT",i.CLOSED="CLOSED",i.CHANNEL_ERROR="CHANNEL_ERROR"})(A||(A={}));var w=class i{constructor(e,t={config:{}},n){this.topic=e,this.params=t,this.socket=n,this.bindings={},this.state=g.closed,this.joinedOnce=!1,this.pushBuffer=[],this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""}},t.config),this.timeout=this.socket.timeout,this.joinPush=new T(this,j.join,this.params,this.timeout),this.rejoinTimer=new L(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=g.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=g.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=g.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=g.errored,this.rejoinTimer.scheduleTimeout())}),this._on(j.reply,{},(s,r)=>{this._trigger(this._replyEventName(r),s)}),this.presence=new y(this)}subscribe(e,t=this.timeout){var n,s;if(this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{let{config:{broadcast:r,presence:o}}=this.params;this._onError(h=>e&&e("CHANNEL_ERROR",h)),this._onClose(()=>e&&e("CLOSED"));let c={},l={broadcast:r,presence:o,postgres_changes:(s=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(h=>h.filter))!==null&&s!==void 0?s:[]};this.socket.accessToken&&(c.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:l},c)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",({postgres_changes:h})=>{var a;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),h===void 0){e&&e("SUBSCRIBED");return}else{let d=this.bindings.postgres_changes,_=(a=d?.length)!==null&&a!==void 0?a:0,f=[];for(let v=0;v<_;v++){let p=d[v],{filter:{event:m,schema:C,table:E,filter:O}}=p,b=h&&h[v];if(b&&b.event===m&&b.schema===C&&b.table===E&&b.filter===O)f.push(Object.assign(Object.assign({},p),{id:b.id}));else{this.unsubscribe(),e&&e("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=f,e&&e("SUBSCRIBED");return}}).receive("error",h=>{e&&e("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(h).join(", ")||"error")))}).receive("timeout",()=>{e&&e("TIMED_OUT")})}return this}presenceState(){return this.presence.state}track(e,t={}){return V(this,void 0,void 0,function*(){return yield this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)})}untrack(e={}){return V(this,void 0,void 0,function*(){return yield this.send({type:"presence",event:"untrack"},e)})}on(e,t,n){return this._on(e,t,n)}send(e,t={}){return new Promise(n=>{var s,r,o;let c=this._push(e.type,e,t.timeout||this.timeout);c.rateLimited&&n("rate limited"),e.type==="broadcast"&&!(!((o=(r=(s=this.params)===null||s===void 0?void 0:s.config)===null||r===void 0?void 0:r.broadcast)===null||o===void 0)&&o.ack)&&n("ok"),c.receive("ok",()=>n("ok")),c.receive("timeout",()=>n("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=g.leaving;let t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(j.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(n=>{let s=new T(this,j.leave,{},e);s.receive("ok",()=>{t(),n("ok")}).receive("timeout",()=>{t(),n("timed out")}).receive("error",()=>{n("error")}),s.send(),this._canPush()||s.trigger("ok",{})})}_push(e,t,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new T(this,e,t,n);return this._canPush()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}_onMessage(e,t,n){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,n){var s,r;let o=e.toLocaleLowerCase(),{close:c,error:l,leave:h,join:a}=j;if(n&&[c,l,h,a].indexOf(o)>=0&&n!==this._joinRef())return;let _=this._onMessage(o,t,n);if(t&&!_)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(f=>{var v,p,m;return((v=f.filter)===null||v===void 0?void 0:v.event)==="*"||((m=(p=f.filter)===null||p===void 0?void 0:p.event)===null||m===void 0?void 0:m.toLocaleLowerCase())===o}).map(f=>f.callback(_,n)):(r=this.bindings[o])===null||r===void 0||r.filter(f=>{var v,p,m,C,E,O;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in f){let b=f.id,D=(v=f.filter)===null||v===void 0?void 0:v.event;return b&&((p=t.ids)===null||p===void 0?void 0:p.includes(b))&&(D==="*"||D?.toLocaleLowerCase()===((m=t.data)===null||m===void 0?void 0:m.type.toLocaleLowerCase()))}else{let b=(E=(C=f?.filter)===null||C===void 0?void 0:C.event)===null||E===void 0?void 0:E.toLocaleLowerCase();return b==="*"||b===((O=t?.event)===null||O===void 0?void 0:O.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===o}).map(f=>{if(typeof _=="object"&&"ids"in _){let v=_.data,{schema:p,table:m,commit_timestamp:C,type:E,errors:O}=v;_=Object.assign(Object.assign({},{schema:p,table:m,commit_timestamp:C,eventType:E,new:{},old:{},errors:O}),this._getPayloadRecords(v))}f.callback(_,n)})}_isClosed(){return this.state===g.closed}_isJoined(){return this.state===g.joined}_isJoining(){return this.state===g.joining}_isLeaving(){return this.state===g.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,n){let s=e.toLocaleLowerCase(),r={type:s,filter:t,callback:n};return this.bindings[s]?this.bindings[s].push(r):this.bindings[s]=[r],this}_off(e,t){let n=e.toLocaleLowerCase();return this.bindings[n]=this.bindings[n].filter(s=>{var r;return!(((r=s.type)===null||r===void 0?void 0:r.toLocaleLowerCase())===n&&i.isEqual(s.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(let n in e)if(e[n]!==t[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(j.close,{},e)}_onError(e){this._on(j.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=g.joining,this.joinPush.resend(e))}_getPayloadRecords(e){let t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=N(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=N(e.columns,e.old_record)),t}};var I=function(i,e,t,n){function s(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function c(a){try{h(n.next(a))}catch(d){o(d)}}function l(a){try{h(n.throw(a))}catch(d){o(d)}}function h(a){a.done?r(a.value):s(a.value).then(c,l)}h((n=n.apply(i,e||[])).next())})},ie=()=>{},B=class{constructor(e,t){var n,s;this.accessToken=null,this.channels=[],this.endPoint="",this.headers=z,this.params={},this.timeout=P,this.transport=te,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=ie,this.conn=null,this.sendBuffer=[],this.serializer=new k,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.eventsPerSecondLimitMs=100,this.inThrottle=!1,this.endPoint=`${e}/${S.websocket}`,t?.params&&(this.params=t.params),t?.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t?.timeout&&(this.timeout=t.timeout),t?.logger&&(this.logger=t.logger),t?.transport&&(this.transport=t.transport),t?.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);let r=(n=t?.params)===null||n===void 0?void 0:n.eventsPerSecond;r&&(this.eventsPerSecondLimitMs=Math.floor(1e3/r));let o=(s=t?.params)===null||s===void 0?void 0:s.apikey;o&&(this.accessToken=o),this.reconnectAfterMs=t?.reconnectAfterMs?t.reconnectAfterMs:c=>[1e3,2e3,5e3,1e4][c-1]||1e4,this.encode=t?.encode?t.encode:(c,l)=>l(JSON.stringify(c)),this.decode=t?.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new L(()=>I(this,void 0,void 0,function*(){this.disconnect(),this.connect()}),this.reconnectAfterMs)}connect(){this.conn||(this.conn=new this.transport(this._endPointURL(),[],null,this.headers),this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e)))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}removeChannel(e){return I(this,void 0,void 0,function*(){let t=yield e.unsubscribe();return this.channels.length===0&&this.disconnect(),t})}removeAllChannels(){return I(this,void 0,void 0,function*(){let e=yield Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e})}log(e,t,n){this.logger(e,t,n)}connectionState(){switch(this.conn&&this.conn.readyState){case x.connecting:return R.Connecting;case x.open:return R.Open;case x.closing:return R.Closing;default:return R.Closed}}isConnected(){return this.connectionState()===R.Open}channel(e,t={config:{}}){this.isConnected()||this.connect();let n=new w(`realtime:${e}`,t,this);return this.channels.push(n),n}push(e){let{topic:t,event:n,payload:s,ref:r}=e,o=()=>{this.encode(e,c=>{var l;(l=this.conn)===null||l===void 0||l.send(c)})};if(this.log("push",`${t} ${n} (${r})`,s),this.isConnected())if(["broadcast","presence","postgres_changes"].includes(n)){if(this._throttle(o)())return"rate limited"}else o();else this.sendBuffer.push(o)}setAuth(e){this.accessToken=e,this.channels.forEach(t=>{e&&t.updateJoinPayload({access_token:e}),t.joinedOnce&&t._isJoined()&&t._push(j.access_token,{access_token:e})})}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(n=>n.topic===e&&(n._isJoined()||n._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:F}))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:n,event:s,payload:r,ref:o}=t;(o&&o===this.pendingHeartbeatRef||s===r?.type)&&(this.pendingHeartbeatRef=null),this.log("receive",`${r.status||""} ${n} ${s} ${o&&"("+o+")"||""}`,r),this.channels.filter(c=>c._isMember(n)).forEach(c=>c._trigger(s,r,o)),this.stateChangeCallbacks.message.forEach(c=>c(t))})}_onConnOpen(){this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(j.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;let n=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${n}${s}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(q,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}_throttle(e,t=this.eventsPerSecondLimitMs){return()=>this.inThrottle?!0:(e(),t>0&&(this.inThrottle=!0,setTimeout(()=>{this.inThrottle=!1},t)),!1)}};export{$ as REALTIME_LISTEN_TYPES,J as REALTIME_POSTGRES_CHANGES_LISTEN_EVENT,U as REALTIME_PRESENCE_LISTEN_EVENTS,A as REALTIME_SUBSCRIBE_STATES,w as RealtimeChannel,B as RealtimeClient,y as RealtimePresence};
//# sourceMappingURL=realtime-js.mjs.map